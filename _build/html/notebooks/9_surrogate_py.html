
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>8. Athey, S., Chetty, R., Imbens, G. W., &amp; Kang, H. (2019). The surrogate index: Combining short-term proxies to estimate long-term treatment effects more rapidly and precisely (No. w26463). National Bureau of Economic Research. &#8212; MGTECON 634 at Stanford (Python scripts)</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="7. Tutorial to simulate data using WGANs" href="8_WGANs_for_simulation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">MGTECON 634 at Stanford (Python scripts)</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../md/intro.html">
                    Machine Learning-Based Causal Inference
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Topics
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1_introduction_1.html">
   1. Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2_introduction_to_machine_learning.html">
   2. Introduction to Machine Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3_average_treatment_effect_1.html">
   3. ATE I: Binary treatment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4_heterogeneous_treatment_effect_1.html">
   4. HTE I: Binary treatment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="5_policy_evaluation_1.html">
   5. Policy Evaluation I - Binary Treatment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="6_policy_learning_1.html">
   6. Policy Learning I - Binary Treatment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="8_WGANs_for_simulation.html">
   7. Tutorial to simulate data using WGANs
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   8. Athey, S., Chetty, R., Imbens, G. W., &amp; Kang, H. (2019). The surrogate index: Combining short-term proxies to estimate long-term treatment effects more rapidly and precisely (No. w26463). National Bureau of Economic Research.
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/d2cml-ai/mgtecon634_python/master?urlpath=tree/_build/jupyter_execute/notebooks/9_surrogate_py.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/d2cml-ai/mgtecon634_python/blob/master/_build/jupyter_execute/notebooks/9_surrogate_py.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/d2cml-ai/mgtecon634_python"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/d2cml-ai/mgtecon634_python/issues/new?title=Issue%20on%20page%20%2Fnotebooks/9_surrogate_py.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/d2cml-ai/mgtecon634_python/edit/master/_build/jupyter_execute/notebooks/9_surrogate_py.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/9_surrogate_py.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   8.1. Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identification">
   8.2. Identification
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unconfoundedness">
     8.2.1. Unconfoundedness
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#surrogacy-and-the-surrogate-index">
     8.2.2. Surrogacy and the Surrogate Index
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#deffinition-1">
       8.2.2.1. Deffinition 1:
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#definition-2">
       8.2.2.2. Definition 2
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#proposition-1">
       8.2.2.3. Proposition 1
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparibility">
   8.3. Comparibility
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#proposition-2">
     8.3.1. Proposition 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition-3">
     8.3.2. Definition 3
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     8.3.3. Identification
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-modules">
   8.4. Import modules
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-wrangling">
   8.5. Data Wrangling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tables">
   8.6. Tables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#appendix-table-1">
     8.6.1. Appendix Table 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#appendix-table-2">
     8.6.2. Appendix Table 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#figures">
   8.7. Figures
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-2-employment-rates-in-riverside-gain-treatment-vs-control-group-by-quarter">
     8.7.1. Figure 2: Employment Rates in Riverside GAIN Treatment vs. Control Group, by Quarter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-3-estimates-of-treatment-effect-on-mean-employment-rates-over-nine-years">
     8.7.2. Figure 3: Estimates of Treatment Effect on Mean Employment Rates Over Nine Years
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-4-validation-of-six-quarter-surrogate-index-estimates-of-treatment-effects-on-mean-employment-rates-varying-outcome-horizon">
     8.7.3. Figure 4 : Validation of Six-Quarter Surrogate Index: Estimates of Treatment Effects on Mean Employment Rates, Varying Outcome Horizon
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-5-bounds-on-mean-treatment-effect-on-employment-rates-over-nine-years-varying-number-of-quarters-used-to-construct-surrogate-index">
     8.7.4. Figure 5: Bounds on Mean Treatment Effect on Employment Rates Over Nine Years, Varying Number of Quarters Used to Construct Surrogate Index
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Athey, S., Chetty, R., Imbens, G. W., & Kang, H. (2019). The surrogate index: Combining short-term proxies to estimate long-term treatment effects more rapidly and precisely (No. w26463). National Bureau of Economic Research.</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   8.1. Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identification">
   8.2. Identification
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unconfoundedness">
     8.2.1. Unconfoundedness
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#surrogacy-and-the-surrogate-index">
     8.2.2. Surrogacy and the Surrogate Index
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#deffinition-1">
       8.2.2.1. Deffinition 1:
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#definition-2">
       8.2.2.2. Definition 2
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#proposition-1">
       8.2.2.3. Proposition 1
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparibility">
   8.3. Comparibility
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#proposition-2">
     8.3.1. Proposition 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition-3">
     8.3.2. Definition 3
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     8.3.3. Identification
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-modules">
   8.4. Import modules
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-wrangling">
   8.5. Data Wrangling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tables">
   8.6. Tables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#appendix-table-1">
     8.6.1. Appendix Table 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#appendix-table-2">
     8.6.2. Appendix Table 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#figures">
   8.7. Figures
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-2-employment-rates-in-riverside-gain-treatment-vs-control-group-by-quarter">
     8.7.1. Figure 2: Employment Rates in Riverside GAIN Treatment vs. Control Group, by Quarter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-3-estimates-of-treatment-effect-on-mean-employment-rates-over-nine-years">
     8.7.2. Figure 3: Estimates of Treatment Effect on Mean Employment Rates Over Nine Years
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-4-validation-of-six-quarter-surrogate-index-estimates-of-treatment-effects-on-mean-employment-rates-varying-outcome-horizon">
     8.7.3. Figure 4 : Validation of Six-Quarter Surrogate Index: Estimates of Treatment Effects on Mean Employment Rates, Varying Outcome Horizon
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#figure-5-bounds-on-mean-treatment-effect-on-employment-rates-over-nine-years-varying-number-of-quarters-used-to-construct-surrogate-index">
     8.7.4. Figure 5: Bounds on Mean Treatment Effect on Employment Rates Over Nine Years, Varying Number of Quarters Used to Construct Surrogate Index
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="athey-s-chetty-r-imbens-g-w-kang-h-2019-the-surrogate-index-combining-short-term-proxies-to-estimate-long-term-treatment-effects-more-rapidly-and-precisely-no-w26463-national-bureau-of-economic-research">
<h1><span class="section-number">8. </span>Athey, S., Chetty, R., Imbens, G. W., &amp; Kang, H. (2019). The surrogate index: Combining short-term proxies to estimate long-term treatment effects more rapidly and precisely (No. w26463). National Bureau of Economic Research.<a class="headerlink" href="#athey-s-chetty-r-imbens-g-w-kang-h-2019-the-surrogate-index-combining-short-term-proxies-to-estimate-long-term-treatment-effects-more-rapidly-and-precisely-no-w26463-national-bureau-of-economic-research" title="Permalink to this headline">#</a></h1>
<p><a class="reference external" href="https://opportunityinsights.org/wp-content/uploads/2019/11/surrogate_paper.pdf">Reference_paper</a></p>
<p><a class="reference external" href="https://github.com/OpportunityInsights/Surrogates-Replication-Code">Reference code</a></p>
<section id="setup">
<h2><span class="section-number">8.1. </span>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h2>
<p>Consider a setting with two samples: an Experimental (<span class="math notranslate nohighlight">\(E\)</span>) sample and an Observational (<span class="math notranslate nohighlight">\(O\)</span>)
sample. The experimental and observational sample contain observations on <span class="math notranslate nohighlight">\(N_E\)</span> and <span class="math notranslate nohighlight">\(N_O\)</span> units,
respectively. It is convenient to view the data as consisting of a single sample of size <span class="math notranslate nohighlight">\(N =
N_E + N_O\)</span>, with <span class="math notranslate nohighlight">\(\mathrm{P, O, E}\)</span> a binary indicator for the group to which unit <span class="math notranslate nohighlight">\(i\)</span> belongs.</p>
<p>For the <span class="math notranslate nohighlight">\(N_E\)</span> individuals in the experimental group, there is a single binary treatment of
interest, <span class="math notranslate nohighlight">\(W_i\{0, 1\}\)</span>, and a primary outcome, denoted by <span class="math notranslate nohighlight">\(Y_i\)</span>. This outcome is not observed
for individuals in the experimental sample. However, we do measure intermediate outcomes,
which we refer to as surrogates (to be defined precisely in Section 3.2), denoted by <span class="math notranslate nohighlight">\(S_i\)</span> for each
individual. Typically, the surrogate outcomes are vector-valued in order to make the properties
we define plausible. Finally, we measure pre-treatment covariates <span class="math notranslate nohighlight">\(X_i\)</span> for each individual. These
variables are known not to be affected by the treatment.</p>
<p>Following the potential outcomes framework or Rubin Causal Model (Rubin 1974; Holland
1986; Imbens and Rubin 2015), individuals in this group have two pairs of potential outcomes:
<span class="math notranslate nohighlight">\(\left(Y_i(0), Y_i(1)\right)\)</span> and <span class="math notranslate nohighlight">\(\left(S_i(0), S_i(1)\right)\)</span>. The realized outcomes are related to their respective potential outcomes as follows.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
Y_i=\left\{\begin{array}{ll}Y_i(0) &amp; \text { if } W_i=0, \\ Y_i(1) &amp; \text { if } W_i=1,\end{array} \quad\right. \quad \text{and } 
S_i = \left\{
\begin{array}{ll}S_i(0) &amp; \text { if } W_i=0, \\ S_i(1) &amp; \text { if } W_i=1,\end{array}
\right .
\end{split}\]</div>
<p>Overall, the units are characterized by the values of the sextuple <span class="math notranslate nohighlight">\(\left(Y_i(0), Y_i(1), S_i(0), S_i(1), X_i, W_i\right)\)</span>.
We do not observe the full sextuple for any units. Rather, for units in the experimental sample
we observe only the triple <span class="math notranslate nohighlight">\(\left(X_i, W_i, S_i\right)\)</span> with support <span class="math notranslate nohighlight">\(\mathbb X, \mathbb W = \{0, 1\}\)</span>, and <span class="math notranslate nohighlight">\(\mathbb S\)</span> respectively. In the
observational sample, we do not observe to which treatment the NO individuals were assigned.
We observe the triple <span class="math notranslate nohighlight">\((X_i, S_i, Y_i)\)</span>, with support <span class="math notranslate nohighlight">\(\mathbb X, \mathbb S\)</span>, and <span class="math notranslate nohighlight">\(\mathbb Y\)</span> respectively.</p>
<p>We are interested in the average effect of the treatment on the primary outcome in the
population from which the experimental sample is drawn:</p>
<div class="math notranslate nohighlight">
\[
\tau  = \mathbb{E}[
    y_i(1) - Y_i(0) | P_i = E
]
\]</div>
<p>or similar estimands, such as the average primary outcome for the treated units, or for some other
subpopulation. For ease of exposition, we focus on estimating the ATE <span class="math notranslate nohighlight">\(\tau\)</span> here. The fundamental
problem in estimating <span class="math notranslate nohighlight">\(\tau\)</span> in the experimental group is that the outcome <span class="math notranslate nohighlight">\(Y_i\)</span> is missing for all units in the experimental sample. To address this missing data problem, we exploit the observational
sample and its link to the experimental sample through the presence of the surrogate outcomes
<span class="math notranslate nohighlight">\(S_i\)</span>. Note that the surrogates, like the pre-treatment variables, are not of intrinsic interest. The
average causal effect of the treatment on the surrogates, <span class="math notranslate nohighlight">\(\tau_S = E[S_i(1) − S_i(0)|P_i = \mathrm E]\)</span>, is of
interest only insofar as it aids in estimation of <span class="math notranslate nohighlight">\(\tau\)</span>.</p>
</section>
<section id="identification">
<h2><span class="section-number">8.2. </span>Identification<a class="headerlink" href="#identification" title="Permalink to this headline">#</a></h2>
<p>In this section, we discuss three assumptions that together allow us to combine the observational
and experimental samples and estimate the causal effect of the treatment on the primary outcome
using a set of intermediate outcomes. The first assumption is unconfoundedness or ignorability,
common in the program evaluation literature, which ensures that adjusting for pre-treatment
variables leads to valid causal effects. The second assumption is the surrogacy condition, which
we define more precisely below, and is the key condition that allows to use the surrogate variables
to proxy for the primary outcome. The third assumption is comparability, which ensures that
we can learn about relationships in the experimental sample from the observational sample.
After stating these three assumptions, we present our main identification result, showing how
the ATE on the primary outcome can be identified by combining intermediate outcomes under
these assumptions.</p>
<section id="unconfoundedness">
<h3><span class="section-number">8.2.1. </span>Unconfoundedness<a class="headerlink" href="#unconfoundedness" title="Permalink to this headline">#</a></h3>
<p>For the individuals in the experimental group, define the propensity score as the conditional
probability of receiving the treatment: <span class="math notranslate nohighlight">\(e(x) = \mathrm{pr}\left(Wi = 1 | X_i = x, P_i = E\right)\)</span>. We assume that for individuals in the experimental group, treatment assignment is unconfounded and we have overlap in the distribution of pre-treatment variables between the treatment and control groups (Rosenbaum and Rubin 1983).</p>
<p><strong>Assumption 1.</strong> (Unconfounded Treatment Assignment / Strong Ignorability)</p>
<p><span class="math notranslate nohighlight">\((i)\quad W_i \perp\left(Y_i(0), Y_i(1), S_i(0), S_i(1)\right) \mid X_i, P_i=\mathrm{E}\)</span></p>
<p><span class="math notranslate nohighlight">\((ii) \quad 0&lt;e(x)&lt;1\)</span> for all <span class="math notranslate nohighlight">\(x \in \mathbb{X}\)</span>.</p>
<p>This assumption implies that in the experimental group, we could estimate the average causal
effect of the treatment on the outcome <span class="math notranslate nohighlight">\(Y_i\)</span> by adjusting for pre-treatment variables, if the <span class="math notranslate nohighlight">\(Y_i\)</span> were measured.</p>
</section>
<section id="surrogacy-and-the-surrogate-index">
<h3><span class="section-number">8.2.2. </span>Surrogacy and the Surrogate Index<a class="headerlink" href="#surrogacy-and-the-surrogate-index" title="Permalink to this headline">#</a></h3>
<p>Because the primary outcome is not measured in the experimental group, we exploit surrogates
to identify the treatment effect of <span class="math notranslate nohighlight">\(W\)</span> on <span class="math notranslate nohighlight">\(Y\)</span> . The defining property of these surrogates <span class="math notranslate nohighlight">\(S_i\)</span> is the following condition</p>
<p><strong>Assumption 2</strong> (Surrogacy)</p>
<div class="math notranslate nohighlight">
\[
W_i \perp Y_i \mid S_i, X_i, P_i = \mathrm E.
\]</div>
<p>Intuitively, the surrogacy condition requires that the surrogates fully capture the causal
link between the treatment and the primary outcome. Figure 1 illustrates the content of this
assumption using directed acyclical graphs to represent the causal chain from the treatment to
the surrogate to the long-term outcome, as in Pearl (1995). Panel A shows a DAG where the
surrogacy assumption is satisfied by a single intermediate outcome <span class="math notranslate nohighlight">\(S\)</span> that lies on the causal
chain between <span class="math notranslate nohighlight">\(W\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> . Panel B shows an example where Assumption 2 is violated because
there is a direct effect of the treatment on the outcome that does not pass through the surrogate.</p>
<p>Panel <span class="math notranslate nohighlight">\(C\)</span> shows our approach to addressing this problem: introducing multiple intermediate
outcomes that together span the causal chain from <span class="math notranslate nohighlight">\(W\)</span> to <span class="math notranslate nohighlight">\(Y\)</span> . In this example, the three inter-
mediate outcomes together span the causal chain from <span class="math notranslate nohighlight">\(W\)</span> to <span class="math notranslate nohighlight">\(Y\)</span> and hence can be combined to
construct a surrogate index that captures long-term treatment effects. Importantly, one does
not necessarily have to observe every intermediate outcome that lies on the causal chain between
<span class="math notranslate nohighlight">\(W\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> . For example, if a treatment (e.g., smaller class sizes) affects earnings by increasing
both math and science aptitude, math scores by themselves could serve as a valid surrogate if
math and science scores are perfectly correlated. The key requirement is that the set of inter-
mediate outcomes together span the set of causal pathways, either because they themselves are
the causal factors or because they are correlated with the causal factors.</p>
<p>It is instructive to compare the surrogacy assumption to the exclusion restriction assumption
familiar to economists in instrumental variables settings. Figure 1d shows a DAG representation
of the standard instrumental variables (IV) model, where there is an unobserved confounder
between <span class="math notranslate nohighlight">\(W\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> . In the standard IV approach, this confound is addressed by introducing
an instrument <span class="math notranslate nohighlight">\(Z\)</span> that affects <span class="math notranslate nohighlight">\(W\)</span> but does not affect <span class="math notranslate nohighlight">\(Y\)</span> directly (the exclusion restriction). In
the surrogacy case, we are interested in the effect of <span class="math notranslate nohighlight">\(W\)</span> on <span class="math notranslate nohighlight">\(Y\)</span> , where we assume there is no
confounder between <span class="math notranslate nohighlight">\(W\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> (or, equivalently, we find an instrument for <span class="math notranslate nohighlight">\(W\)</span> that eliminates
such confounds). This is analogous to the (reduced-form) effect of <span class="math notranslate nohighlight">\(Z\)</span> on <span class="math notranslate nohighlight">\(Y\)</span> in the IV case. The
reduced-form effect can be estimated directly in the IV case because <span class="math notranslate nohighlight">\(Z\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> are both observed
in the same dataset. The problem we address here is how to estimate the effect of <span class="math notranslate nohighlight">\(Z\)</span> (or <span class="math notranslate nohighlight">\(W\)</span>,
assuming unconfoundedness) on <span class="math notranslate nohighlight">\(Y\)</span> when they are not observed in the same dataset. The analog
to the exclusion restriction here is that there is no direct effect of <span class="math notranslate nohighlight">\(W\)</span> on <span class="math notranslate nohighlight">\(Y\)</span> that does not run
through <span class="math notranslate nohighlight">\(S\)</span>.</p>
<p>We exploit the availability of multiple intermediate outcomes by defining two concepts: the
surrogate index and surrogate score.</p>
<section id="deffinition-1">
<h4><span class="section-number">8.2.2.1. </span>Deffinition 1:<a class="headerlink" href="#deffinition-1" title="Permalink to this headline">#</a></h4>
<p>The surrogate Index: <em>The surrogate index is the conditional expectation
of the primary outcome given the surrogate outcomes and the pre-treatment variables in the
observational sample:</em></p>
<div class="math notranslate nohighlight">
\[
h_0(s, x) = \mathbb{E}[Y_i|S_i = s, X_i = x, P_i = O]
\]</div>
<p>The surrogate index <span class="math notranslate nohighlight">\(h_0(s, x)\)</span> is estimable because we observe the triple <span class="math notranslate nohighlight">\(\left(Y_i, S_i, X_i\right)\)</span> in the observational sample. In a linear model, the surrogate index is simply a linear combination of the individual intermediate outcomes – the predicted value from a regression of the primary outcome on the intermediate outcomes.</p>
</section>
<section id="definition-2">
<h4><span class="section-number">8.2.2.2. </span>Definition 2<a class="headerlink" href="#definition-2" title="Permalink to this headline">#</a></h4>
<p>The Surrogate Score: <em>The surrogate score is the conditional probability of
having received the treatment given the value for the surrogate outcomes and the covariates:</em></p>
<div class="math notranslate nohighlight">
\[
r(s, x) = pr(W_i = 1 | S_i = s, X_i = s, P_i = \mathrm{E})
\]</div>
<p>Like the propensity score, the surrogate score facilitates statistical procedures that adjust
only for scalar differences in other variables, irrespective of the dimension of the statistical
surrogates.</p>
</section>
<section id="proposition-1">
<h4><span class="section-number">8.2.2.3. </span>Proposition 1<a class="headerlink" href="#proposition-1" title="Permalink to this headline">#</a></h4>
<p>Surrogate Score: <em>Suppose Assumption 2 holds. Then:</em></p>
<div class="math notranslate nohighlight">
\[
W_i \perp Y_i \mid r(S_i, X_i, P_i) = \mathrm{E}
\]</div>
</section>
</section>
</section>
<section id="comparibility">
<h2><span class="section-number">8.3. </span>Comparibility<a class="headerlink" href="#comparibility" title="Permalink to this headline">#</a></h2>
<p>Surrogacy and unconfoundedness by themselves are not sufficient for consistent estimation of <span class="math notranslate nohighlight">\(\tau\)</span>
by itself because they do not place restrictions on how the relationship between <span class="math notranslate nohighlight">\(Y\)</span> and <span class="math notranslate nohighlight">\(S\)</span> in the
observational sample compares to that in the experimental sample. The final assumption we
make is that the conditional distribution of <span class="math notranslate nohighlight">\(Y_i\)</span> given (<span class="math notranslate nohighlight">\(S_i\)</span>, <span class="math notranslate nohighlight">\(X_i\)</span>) in the observational sample is the same as the conditional distribution of <span class="math notranslate nohighlight">\(Y_i\)</span> given (<span class="math notranslate nohighlight">\(S_i\)</span>, <span class="math notranslate nohighlight">\(X_i\)</span>) in the experimental sample. Formally, Assumption 3. (Comparability of Samples)</p>
<p><strong>Assumption 3</strong>. (Comparability of Samples)</p>
<div class="math notranslate nohighlight">
\[
Y_i\left|S_i, X_i, P_i=\mathrm{O} \sim Y_i\right| S_i, X_i, P_i=\mathrm{E}
\]</div>
<p>We can state this assumption equivalently as:</p>
<div class="math notranslate nohighlight">
\[
P_i \perp Y_i | S_i, X_i
\]</div>
<p>To understand the role of the comparability assumption, note that there are two conditional
expectations that are closely related to the conditional expectation in the definition of the
surrogate index above, but which we cannot directly estimate because we do not observe <span class="math notranslate nohighlight">\(Y\)</span> in
the experimental sample. The first is the conditional expectation corresponding to the definition
of the surrogate index above within the experimental sample:</p>
<div class="math notranslate nohighlight">
\[
h_E(s, x) = \mathbb{E}\left[Y_i | S_i, X_i = x, P_i = E\right]
\]</div>
<p>The second is the conditional expectation of the potential outcomes given pre-treatment variables
and the surrogates:</p>
<div class="math notranslate nohighlight">
\[
\mu _E(s, x, w) = \mathbb{E}\left[Y_i | S_i = s, X_i = x, W_i = w, P_i = E\right]
\]</div>
<p>These conditional expectations are all equivalent under comparability and surrogacy, allowing us
to take the relationship between <span class="math notranslate nohighlight">\(Y\)</span> and <span class="math notranslate nohighlight">\(S\)</span> estimated in the observational sample and apply it in
the experimental sample. In effect, comparability and surrogacy together allow us to impute the
missing primary outcomes in the experimental sample, as shown by the following proposition.</p>
<section id="proposition-2">
<h3><span class="section-number">8.3.1. </span>Proposition 2<a class="headerlink" href="#proposition-2" title="Permalink to this headline">#</a></h3>
<p>Surrogate Index:</p>
<p><em>(i) Suppose Assumption 2 holds. Then:</em></p>
<div class="math notranslate nohighlight">
\[
\mu_E(s, x, w) = h_E(s, x), \quad \text{for all } s \in \mathbb{S}, \quad x \in \mathbb{X}, \text{and } w \in \mathbb{W}
\]</div>
<p><em>(ii) Suppose Assumption 3 holds. Then:</em></p>
<div class="math notranslate nohighlight">
\[
h_E(s, x) = h_O(s, x) \text{ for all } s \in S, \text{ and } x \in X
\]</div>
<p><em>(iii) Suppose Assumptions 2 and 3 hold. Then:</em></p>
<div class="math notranslate nohighlight">
\[
\mu_E(s, x, w) = h_O(s, x) \text{ for all } s \in S, x \in X, \text{ and } w \in W.
\]</div>
<p>Part <em>(iii)</em> of Proposition 2 relates the conditional expectation of interest, <span class="math notranslate nohighlight">\(\mu_E(s, x, w)\)</span>, to a
conditional expectation that is directly estimable, <span class="math notranslate nohighlight">\(h_O(s, x)\)</span>.
Finally, we define weights that make the observational and experimental samples comparable.
Let <span class="math notranslate nohighlight">\(q = N_E/(N_E + N_O)\)</span> denote the sampling weight of being in the experimental sample and
<span class="math notranslate nohighlight">\((1 − q)\)</span> be the sampling weight of being in the observational sample. Define the propensity to
be in the experimental sample <span class="math notranslate nohighlight">\(P_i = E\)</span> as follows:</p>
</section>
<section id="definition-3">
<h3><span class="section-number">8.3.2. </span>Definition 3<a class="headerlink" href="#definition-3" title="Permalink to this headline">#</a></h3>
<p>Sampling Score</p>
<div class="math notranslate nohighlight">
\[
t(s, x) = \mathrm{pr}\left(P_ = E| S_i = s, X_i = x\right) = \frac{
    \mathrm{pr(S_i = s, X_i = x | P_i = E})q
}{
    \mathrm{
        pr(S_i = s, X_i = x| P_i = E) q + pr(S_i = s, X_i = x | P_i = \mathrm{O})(1 - q)
    }
} .
\]</div>
<p>We also make the assumption:</p>
<p><strong>Assumption 4:</strong> Overlap in Sampling Score</p>
<div class="math notranslate nohighlight">
\[t(s, x) &lt; 1 \text{ for all } x \in \mathbb{S} \text{ and } x \in \mathbb{X}\]</div>
</section>
<section id="id1">
<h3><span class="section-number">8.3.3. </span>Identification<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>We now present our central identification result. We present three different representations of the
average treatment effect that lead to three estimation strategies. The motivation for developing
the different representations is that estimators corresponding to those different representations
can have different properties in finite samples. The first representation requires estimation of
the surrogate index, but not the surrogate score. The second representation instead requires
estimation of the surrogate score, but not the surrogate index. The third representation requires
estimation of both.</p>
<p>We define the following three objects, all functionals of distributions that are directly estimable from the data, starting with a surrogate index representation:</p>
<div class="math notranslate nohighlight">
\[
\tau^{\mathrm{E}}=\mathbb{E}\left[h_{\mathrm{O}}\left(S_i, X_i\right) \cdot \frac{W_i}{e\left(X_i\right)}-h_{\mathrm{O}}\left(S_i, X_i\right) \cdot \frac{1-W_i}{1-e\left(X_i\right)} \mid P_i=\mathrm{E}\right]
\]</div>
<p>then a surrogate score representation</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\begin{split}
\begin{aligned}
    \tau^O= &amp; \mathbb{E}\left[Y_i \cdot \frac{r\left(S_i, X_i\right) \cdot t\left(S_i, X_i\right) \cdot(1-q)}{e\left(X_i\right) \cdot\left(1-t\left(S_i, X_i\right)\right) \cdot q}\right.\\\end{split}\\\begin{split}    &amp; \left. -Y_i \cdot \frac{\left(1-r\left(S_i, X_i\right)\right) \cdot t\left(S_i, X_i\right) \cdot(1-q)}{\left(1-e\left(X_i\right)\right) \cdot\left(1-t\left(S_i, X_i\right)\right) \cdot q} \mid P_i=\mathrm{O}\right]\\
\end{aligned}
\end{split}\end{aligned}\end{align} \]</div>
<p>and finally an influence function repretentation:</p>
<div class="math notranslate nohighlight">
\[
\tau^{\mathrm{O}, \mathrm{E}} = \mathbb{E}[
    \psi (P_i, Y_i, S_i, W_i, X_i)
]
\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned} \psi(p, y, s, w, x) =&amp;\frac{1_{p=\mathrm{E}}}{q}\left(\frac{h_{\mathrm{O}}(s, x) w}{e(x)}-\frac{h_{\mathrm{O}}(s, x)(1-w)}{1-e(x)}\right) \\
&amp;+ \frac{1_{p=\mathrm{O}}}{1-q}\left(\frac{t(s, x)}{1-t(s, x)} \frac{1-q}{q}\right) \frac{\left(y-h_{\mathrm{O}}(s, x)\right)(r(s, x)-e(x))}{e(x)(1-e(x))} . \end{aligned}
\end{split}\]</div>
<p>Theorem 1. <em>(Identification) Suppose Assumptions 1–4 hold. Then the average treatment effect is equal to the following three estimable functions of the data:</em></p>
<div class="math notranslate nohighlight">
\[
\tau \equiv \mathbb{E}[
    Y_i(1) - Y_i(0)|P_i = \mathrm{E} 
] = \tau ^ \mathrm{E} = \tau ^ \mathrm{O} =
\tau ^ {\mathrm{O, E}}.
\]</div>
<p>The first representation, <span class="math notranslate nohighlight">\(\tau_E\)</span>, shows how <span class="math notranslate nohighlight">\(\tau\)</span> can be written as the expected value of the
propensity-score-adjusted difference between treated and controls of the surrogate index in the
experimental sample. This will lead to an estimation strategy in which the missing <span class="math notranslate nohighlight">\(Y_i\)</span> in the experimental sample are imputed by <span class="math notranslate nohighlight">\(\hat h(S_i, X_i)\)</span> estimated on the observational sample. The second
representation, <span class="math notranslate nohighlight">\(\tau^\mathrm O\)</span>, shows how <span class="math notranslate nohighlight">\(\tau\)</span> can be written as the expected value of the difference in two
weighted averages of the outcome in the observational sample, with the weights a function of
the surrogate score estimated on the experimental sample and the sampling score. This will lead
to an estimation strategy in which the <span class="math notranslate nohighlight">\(Y_i\)</span> in the observational sample are weighted proportional
to the estimated surrogate score to estimate <span class="math notranslate nohighlight">\(\mathbb E[Y_i(1)|P_i = \mathrm E]\)</span>, and weighted proportional to
one minus the estimated surrogate score to estimate <span class="math notranslate nohighlight">\(\mathbb E[Y_i(0)|Pi = E]\)</span>. The third representation
uses the score function representation, requiring estimation of both the surrogate score and the
surrogate index.</p>
<p>Under smoothness assumptions, we can derive the semi-parametric efficiency bound for <span class="math notranslate nohighlight">\(\tau\)</span>
(e.g., Bickel et al. 1993; Newey 1990). Because the model is just identified (the model has no
testable implications), it follows that the semi-parametric efficiency bound is the square of the
influence function <span class="math notranslate nohighlight">\(\psi(\cdot) - \tau\)</span>:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}
\begin{aligned}\\\begin{split}\mathbb{V}_s  = &amp; \mathbb{E}\left[\left(\psi\left(P_i, Y_i, X_i, S_i, W_i\right)-\tau\right)^2\right] \\\end{split}\\\begin{split}= &amp;\mathbb{E}\left[\frac{\sigma^2\left(S_i\right)}{1-t\left(S_i, X_i\right)} \cdot\left(\frac{r\left(S_i, X_i\right)}{e\left(X_i\right)^2}+\frac{1-r\left(S_i, X_i\right)}{\left(1-e\left(X_i\right)\right)^2}-2 \cdot \frac{r\left(S_i, X_i\right) \cdot\left(1-r\left(S_i, X_i\right)\right)}{e\left(X_i\right)^2 \cdot\left(1-e\left(X_i\right)\right)^2}\right)\right.\\\end{split}\\&amp; \left.+\frac{1}{t\left(S_i, X_i\right)} \cdot\left\{\frac{r\left(S_i, X_i\right)}{e\left(X_i\right)} \cdot\left(\mu\left(S_i, X_i\right)-\mu_1\right)^2+\frac{1-r\left(S_i, X_i\right)}{1-e\left(X_i\right)} \cdot\left(\mu\left(S_i, X_i\right)-\mu_0\right)^2\right\}\right]
\end{aligned}
\end{aligned}\end{align} \]</div>
<p>Again because of the just-identified nature of this model, the results in Newey (1994) also imply
that nonparametric estimators of the surrogacy score, the surrogacy index, and the propensity
score can be used to obtain efficient estimators for <span class="math notranslate nohighlight">\(\tau\)</span></p>
</section>
</section>
<section id="import-modules">
<h2><span class="section-number">8.4. </span>Import modules<a class="headerlink" href="#import-modules" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data wrangling</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="c1"># Estimations</span>
<span class="kn">import</span> <span class="nn">patsy</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span><span class="o">,</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="c1"># Plots</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># skip irrelevant warnings</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">statsmodels.iolib.summary2</span> <span class="kn">import</span> <span class="n">summary_col</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-wrangling">
<h2><span class="section-number">8.5. </span>Data Wrangling<a class="headerlink" href="#data-wrangling" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import Data</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_stata</span><span class="p">(</span><span class="s2">&quot;https://github.com/OpportunityInsights/Surrogates-Replication-Code/raw/master/Data-raw/simulated%20Riverside</span><span class="si">%20G</span><span class="s2">AIN</span><span class="si">%20d</span><span class="s2">ata.dta&quot;</span><span class="p">)</span>
<span class="n">dat</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>site</th>
      <th>treatment</th>
      <th>emp1</th>
      <th>emp2</th>
      <th>emp3</th>
      <th>emp4</th>
      <th>emp5</th>
      <th>emp6</th>
      <th>emp7</th>
      <th>...</th>
      <th>emp27</th>
      <th>emp28</th>
      <th>emp29</th>
      <th>emp30</th>
      <th>emp31</th>
      <th>emp32</th>
      <th>emp33</th>
      <th>emp34</th>
      <th>emp35</th>
      <th>emp36</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>Riverside</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>...</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>Riverside</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>Riverside</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.0</td>
      <td>Riverside</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>...</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>Riverside</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 39 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To replicate the following stata regression (`reg treatment `outcome&#39;1-`outcome&#39;`q&#39; `), </span>
<span class="c1">## we created the following function</span>
<span class="k">def</span> <span class="nf">emp_eq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;emp_cm36&quot;</span><span class="p">,</span> <span class="n">x_v</span> <span class="o">=</span> <span class="s2">&quot;emp&quot;</span><span class="p">):</span> 
    <span class="n">eq</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2"> ~ emp1&quot;</span>
    
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x_v</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; + </span><span class="si">{</span><span class="n">x</span><span class="si">}{</span><span class="n">x1</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">vl</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">vl</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span> <span class="o">+</span> <span class="n">add</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>
        <span class="n">vl</span> <span class="o">=</span> <span class="n">vl</span> <span class="o">+</span> <span class="mi">1</span>
    
    <span class="k">return</span> <span class="n">eq</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Generate cumulative means of employment and quarterly wage earnings, from Q6 forward</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;emp_cm1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;emp1&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;emp_cm</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;emp</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;emp_cm</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
        
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;emp_cm</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;emp_cm</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">i</span>

<span class="n">y_reg</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">y_reg1</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">y_reg2</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">bias</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">surrogate_index</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">naive_index</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">emp_weight_p</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">emp_weight_se</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1">## Store regressions</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
    <span class="n">data_1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">treatment</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_ref</span><span class="p">,</span> <span class="n">x_ref</span> <span class="o">=</span> <span class="n">patsy</span><span class="o">.</span><span class="n">dmatrices</span><span class="p">(</span><span class="n">emp_eq</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data_1</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;dataframe&quot;</span><span class="p">)</span> 
    <span class="n">y_reg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y_ref</span><span class="p">,</span> <span class="n">x_ref</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="c1"># emp_values = np.array(pd.DataFrame(y_reg[i].tables[1].data).iloc[1, [1, 2]])</span>
    <span class="n">emp_weight_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_reg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">params</span> 
    <span class="n">emp_weight_se</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_reg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">conf_int</span><span class="p">()</span>
    
    <span class="c1">## Estimate treatment effect on surrogate index</span>
    <span class="n">y_nn</span><span class="p">,</span> <span class="n">x_all</span> <span class="o">=</span> <span class="n">patsy</span><span class="o">.</span><span class="n">dmatrices</span><span class="p">(</span><span class="n">emp_eq</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;dataframe&quot;</span><span class="p">)</span> 
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;y_surrogate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_reg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_all</span><span class="p">)</span>
    <span class="n">surrogate_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s2">&quot;y_surrogate ~ C(treatment)&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="n">y_reg1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;emp_cm36 ~ emp</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data_1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;single_surrogate</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_reg1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_all</span><span class="p">)</span> 
    <span class="n">naive_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;single_surrogate</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> ~ treatment&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span> 
    
    <span class="c1">## Create naive estimate of treatment effect on mean</span>
    <span class="n">y_reg2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;emp_cm</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> ~ treatment&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="c1">## Create &quot;ground truth&quot;: experimental estimate of treatment effect on mean </span>
    <span class="n">exp_reg</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;emp_cm36 ~ treatment&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="c1">## Bias</span>
    <span class="n">bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">emp_eq</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;treatment&quot;</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="tables">
<h2><span class="section-number">8.6. </span>Tables<a class="headerlink" href="#tables" title="Permalink to this headline">#</a></h2>
<section id="appendix-table-1">
<h3><span class="section-number">8.6.1. </span>Appendix Table 1<a class="headerlink" href="#appendix-table-1" title="Permalink to this headline">#</a></h3>
<p>Estimates of Treatment Effects on Employment and Earnings Over Nine Years,
Varying Quarters of Data Used to Construct Surrogate Index</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
    <span class="n">ett</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">surrogate_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> - Quarter Estimate Treatment Effect </span><span class="se">\t</span><span class="si">{</span><span class="n">ett</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> </span><span class="se">\t\t\t\t\t</span><span class="s2">(</span><span class="si">{</span><span class="n">ett</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">summary_col</span><span class="p">([</span><span class="n">y_reg</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">y_reg</span><span class="p">[</span><span class="mi">12</span><span class="p">]],</span> <span class="n">model_names</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Six - Quarter</span><span class="se">\n</span><span class="s2">Surrogate Index&quot;</span><span class="p">,</span> <span class="s2">&quot;Twelve - Quarter</span><span class="se">\n</span><span class="s2">Surrogate Index&quot;</span><span class="p">),</span> <span class="n">regressor_order</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Intercept&quot;</span><span class="p">,</span> <span class="s2">&quot;emp1&quot;</span><span class="p">,</span> <span class="s2">&quot;emp2&quot;</span><span class="p">,</span> <span class="s2">&quot;emp3&quot;</span><span class="p">,</span> <span class="s2">&quot;emp4&quot;</span><span class="p">,</span> <span class="s2">&quot;emp5&quot;</span><span class="p">,</span> <span class="s2">&quot;emp6&quot;</span><span class="p">,</span> <span class="s2">&quot;emp7&quot;</span><span class="p">,</span> <span class="s2">&quot;emp8&quot;</span><span class="p">,</span> <span class="s2">&quot;emp9&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6 - Quarter Estimate Treatment Effect 	0.0748 
 					(0.007)
12 - Quarter Estimate Treatment Effect 	0.0789 
 					(0.009)
</pre></div>
</div>
<div class="output text_html"><table class="simpletable">
<tr>
         <td></td>         <th>Six - Quarter</th>  <th>Twelve - Quarter</th>
</tr>
<tr>
         <td></td>        <th>Surrogate Index</th>  <th>Surrogate Index</th>
</tr>
<tr>
  <th>Intercept</th>          <td>0.1298</td>           <td>0.0760</td>     
</tr>
<tr>
  <th></th>                  <td>(0.0049)</td>         <td>(0.0039)</td>    
</tr>
<tr>
  <th>emp1</th>               <td>0.0754</td>           <td>0.0582</td>     
</tr>
<tr>
  <th></th>                  <td>(0.0104)</td>         <td>(0.0080)</td>    
</tr>
<tr>
  <th>emp2</th>               <td>0.0178</td>           <td>0.0268</td>     
</tr>
<tr>
  <th></th>                  <td>(0.0106)</td>         <td>(0.0082)</td>    
</tr>
<tr>
  <th>emp3</th>               <td>0.0812</td>           <td>0.0493</td>     
</tr>
<tr>
  <th></th>                  <td>(0.0113)</td>         <td>(0.0088)</td>    
</tr>
<tr>
  <th>emp4</th>               <td>0.0607</td>           <td>0.0243</td>     
</tr>
<tr>
  <th></th>                  <td>(0.0119)</td>         <td>(0.0092)</td>    
</tr>
<tr>
  <th>emp5</th>               <td>0.0970</td>           <td>0.0467</td>     
</tr>
<tr>
  <th></th>                  <td>(0.0117)</td>         <td>(0.0092)</td>    
</tr>
<tr>
  <th>emp6</th>               <td>0.2276</td>           <td>0.0560</td>     
</tr>
<tr>
  <th></th>                  <td>(0.0103)</td>         <td>(0.0097)</td>    
</tr>
<tr>
  <th>emp7</th>                  <td></td>              <td>0.0415</td>     
</tr>
<tr>
  <th></th>                      <td></td>             <td>(0.0101)</td>    
</tr>
<tr>
  <th>emp8</th>                  <td></td>              <td>0.0290</td>     
</tr>
<tr>
  <th></th>                      <td></td>             <td>(0.0102)</td>    
</tr>
<tr>
  <th>emp9</th>                  <td></td>              <td>0.0642</td>     
</tr>
<tr>
  <th></th>                      <td></td>             <td>(0.0104)</td>    
</tr>
<tr>
  <th>emp10</th>                 <td></td>              <td>0.0484</td>     
</tr>
<tr>
  <th></th>                      <td></td>             <td>(0.0112)</td>    
</tr>
<tr>
  <th>emp11</th>                 <td></td>              <td>0.0740</td>     
</tr>
<tr>
  <th></th>                      <td></td>             <td>(0.0116)</td>    
</tr>
<tr>
  <th>emp12</th>                 <td></td>              <td>0.2168</td>     
</tr>
<tr>
  <th></th>                      <td></td>             <td>(0.0097)</td>    
</tr>
<tr>
  <th>R-squared</th>          <td>0.4321</td>           <td>0.6608</td>     
</tr>
<tr>
  <th>R-squared Adj.</th>     <td>0.4313</td>           <td>0.6599</td>     
</tr>
</table></div></div>
</div>
</section>
<section id="appendix-table-2">
<h3><span class="section-number">8.6.2. </span>Appendix Table 2<a class="headerlink" href="#appendix-table-2" title="Permalink to this headline">#</a></h3>
<p>Estimates of Treatment Effects on Employment and Earnings Over Nine Years,
Varying Quarters of Data Used to Construct Surrogate Index</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quarter Used </span><span class="se">\t</span><span class="s2"> Employment</span><span class="se">\t</span><span class="s2"> Earnings&quot;</span> <span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
    <span class="c1"># print(pd.DataFrame(surrogate_index[i].summary().tables[1].data))</span>
    <span class="n">c_ef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">surrogate_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">s_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">surrogate_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> </span><span class="se">\t\t</span><span class="s2">   </span><span class="si">{</span><span class="n">c_ef</span><span class="si">}</span><span class="se">\t</span><span class="s2">    .</span><span class="se">\n\t\t</span><span class="s2">   (</span><span class="si">{</span><span class="n">s_e</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="s2">   (.)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Quarter Used 	 Employment	 Earnings
1 		   0.0155	    .
		   (0.003)	   (.)
2 		   0.0374	    .
		   (0.004)	   (.)
3 		   0.0528	    .
		   (0.005)	   (.)
4 		   0.0579	    .
		   (0.006)	   (.)
5 		   0.0715	    .
		   (0.006)	   (.)
6 		   0.0748	    .
		   (0.007)	   (.)
7 		   0.0748	    .
		   (0.007)	   (.)
8 		   0.0763	    .
		   (0.008)	   (.)
9 		   0.08	    .
		   (0.008)	   (.)
10 		   0.0783	    .
		   (0.008)	   (.)
11 		   0.0799	    .
		   (0.008)	   (.)
12 		   0.0789	    .
		   (0.009)	   (.)
13 		   0.0781	    .
		   (0.009)	   (.)
14 		   0.0786	    .
		   (0.009)	   (.)
15 		   0.0788	    .
		   (0.009)	   (.)
16 		   0.0712	    .
		   (0.009)	   (.)
17 		   0.0749	    .
		   (0.009)	   (.)
18 		   0.0765	    .
		   (0.01)	   (.)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19 		   0.0746	    .
		   (0.01)	   (.)
20 		   0.0769	    .
		   (0.01)	   (.)
21 		   0.0741	    .
		   (0.01)	   (.)
22 		   0.0729	    .
		   (0.01)	   (.)
23 		   0.0741	    .
		   (0.01)	   (.)
24 		   0.0737	    .
		   (0.01)	   (.)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>25 		   0.0727	    .
		   (0.01)	   (.)
26 		   0.0686	    .
		   (0.01)	   (.)
27 		   0.0675	    .
		   (0.01)	   (.)
28 		   0.0653	    .
		   (0.01)	   (.)
29 		   0.0645	    .
		   (0.01)	   (.)
30 		   0.0634	    .
		   (0.011)	   (.)
31 		   0.0647	    .
		   (0.011)	   (.)
32 		   0.0628	    .
		   (0.011)	   (.)
33 		   0.063	    .
		   (0.011)	   (.)
34 		   0.0616	    .
		   (0.011)	   (.)
35 		   0.0624	    .
		   (0.011)	   (.)
36 		   0.062	    .
		   (0.011)	   (.)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="figures">
<h2><span class="section-number">8.7. </span>Figures<a class="headerlink" href="#figures" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Colours</span>
<span class="n">cl</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#75b74d&quot;</span><span class="p">,</span> <span class="s2">&quot;#226fa5&quot;</span><span class="p">]</span>
<span class="n">x_lbl</span> <span class="o">=</span> <span class="s2">&quot;Quarters Since Random Assignment&quot;</span>
</pre></div>
</div>
</div>
</div>
<section id="figure-2-employment-rates-in-riverside-gain-treatment-vs-control-group-by-quarter">
<h3><span class="section-number">8.7.1. </span>Figure 2: Employment Rates in Riverside GAIN Treatment vs. Control Group, by Quarter<a class="headerlink" href="#figure-2-employment-rates-in-riverside-gain-treatment-vs-control-group-by-quarter" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;treatment&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">37</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s2">&quot;t&quot;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">t_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">])</span>
<span class="n">c_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">])</span>
<span class="n">ef</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">t_m</span> <span class="o">-</span> <span class="n">c_m</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Treatment&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">t_m</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Treatment Mean Over 9 Years&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Control&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">36</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">c_m</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Control Mean Over 9 Years&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">.7</span><span class="p">,</span> <span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_lbl</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Employment Rate (%)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;$\tau$ = </span><span class="si">{</span><span class="n">ef</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">t_m</span><span class="p">,</span> <span class="n">c_m</span><span class="p">])),</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">35.7</span><span class="p">,</span> <span class="n">t_m</span><span class="p">),</span> <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="mf">35.7</span><span class="p">,</span> <span class="n">c_m</span><span class="p">),</span> 
            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;&lt;-&gt;&quot;</span><span class="p">,</span>
                            <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3&quot;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9_surrogate_py_19_0.png" src="../_images/9_surrogate_py_19_0.png" />
</div>
</div>
</section>
<section id="figure-3-estimates-of-treatment-effect-on-mean-employment-rates-over-nine-years">
<h3><span class="section-number">8.7.2. </span>Figure 3: Estimates of Treatment Effect on Mean Employment Rates Over Nine Years<a class="headerlink" href="#figure-3-estimates-of-treatment-effect-on-mean-employment-rates-over-nine-years" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">exp_reg</span><span class="o">.</span><span class="n">conf_int</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[[</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># plt.legend()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
    <span class="c1"># for j in range(2):</span>
    <span class="n">sg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">surrogate_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">nv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_reg2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">sg</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nv</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>  
    
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sg</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Surrogate Index Estimate&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nv</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Naive Short-Run Estimate&quot;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>     
    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">naive_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Surrogate Estimate Using Emp. Rate in Quarter x Only&quot;</span><span class="p">)</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">exp_reg</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Actual Mean Treatment Effect Over 36 Quarters&quot;</span><span class="p">)</span>
    <span class="c1"># ax[1].axhline(exp_reg.params[1] * 100, label = &quot;Actual Mean Treatment Effect Over 36 Quarters&quot;)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">.2</span><span class="p">,</span> <span class="mf">.1</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_lbl</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Estimated Treatment Effect on Mean </span><span class="se">\n</span><span class="s2">Employment Rate Over 9 Years (%)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># plt.legend()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span> <span class="o">=</span> <span class="mf">.35</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;A. Varying Quarters of Data Used to Construct Surrogate Index</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;B. Using Employment Rate in a Single Quarter as a Surrogate</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;B. Using Employment Rate in a Single Quarter as a Surrogate\n&#39;)
</pre></div>
</div>
<img alt="../_images/9_surrogate_py_21_1.png" src="../_images/9_surrogate_py_21_1.png" />
</div>
</div>
</section>
<section id="figure-4-validation-of-six-quarter-surrogate-index-estimates-of-treatment-effects-on-mean-employment-rates-varying-outcome-horizon">
<h3><span class="section-number">8.7.3. </span>Figure 4 : Validation of Six-Quarter Surrogate Index: Estimates of Treatment Effects on Mean Employment Rates, Varying Outcome Horizon<a class="headerlink" href="#figure-4-validation-of-six-quarter-surrogate-index-estimates-of-treatment-effects-on-mean-employment-rates-varying-outcome-horizon" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Estimated treatment effect six tweleve</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
    <span class="c1"># print(f&quot;emp_cm{i}&quot;)</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;emp_cm1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;emp1&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;emp_cm</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;emp</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;emp_cm</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;emp_cm</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;emp_cm</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">i</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surr_4</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">surr_4_ix</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">exp_4</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
    <span class="n">surr_4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">emp_eq</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;emp_cm</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data_1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;surr_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">surr_4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">surr_4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s2">&quot;surr_4 ~ treatment&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="n">exp_4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;emp_cm</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> ~ treatment&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># surr_4[12].summary()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">lw0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
    <span class="n">sr</span> <span class="o">=</span> <span class="n">surr_4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">sr_ci</span> <span class="o">=</span> <span class="n">surr_4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">conf_int</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">100</span>
    
    <span class="n">exp</span> <span class="o">=</span> <span class="n">exp_4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">exp_ci</span> <span class="o">=</span> <span class="n">exp_4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">conf_int</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">100</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">sr_ci</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">lw0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">exp_ci</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span> <span class="o">=</span><span class="n">lw0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Actual Experimental Estimate&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Six-Quarter Surrogate Index Estimate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">.1</span><span class="p">,</span> <span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_lbl</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Estimated Treatment Effect on Mean</span><span class="se">\n</span><span class="s2">Employment Rate to Quarter x (%)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9_surrogate_py_24_0.png" src="../_images/9_surrogate_py_24_0.png" />
</div>
</div>
</section>
<section id="figure-5-bounds-on-mean-treatment-effect-on-employment-rates-over-nine-years-varying-number-of-quarters-used-to-construct-surrogate-index">
<h3><span class="section-number">8.7.4. </span>Figure 5: Bounds on Mean Treatment Effect on Employment Rates Over Nine Years, Varying Number of Quarters Used to Construct Surrogate Index<a class="headerlink" href="#figure-5-bounds-on-mean-treatment-effect-on-employment-rates-over-nine-years-varying-number-of-quarters-used-to-construct-surrogate-index" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Bias</span>
<span class="n">va_r</span> <span class="o">=</span> <span class="mf">0.09500865</span>

<span class="n">bias_01_emp_ar</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bias_05_emp_ar</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
    <span class="n">r2_t</span> <span class="o">=</span> <span class="n">y_reg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">rsquared</span>
    <span class="n">r2_o</span> <span class="o">=</span> <span class="n">bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">rsquared</span>
    <span class="n">bias_01_emp</span> <span class="o">=</span> <span class="p">(</span><span class="n">va_r</span> <span class="o">*</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r2_t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r2_o</span><span class="p">)</span> <span class="o">/</span> <span class="n">va_r</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">bias_05_emp</span> <span class="o">=</span> <span class="p">(</span><span class="n">va_r</span> <span class="o">*</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r2_t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r2_o</span><span class="p">)</span> <span class="o">/</span> <span class="n">va_r</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">bias_01_emp_ar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bias_01_emp</span><span class="p">)</span>
    <span class="n">bias_05_emp_ar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bias_05_emp</span><span class="p">)</span>

<span class="n">s_inx</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
    <span class="n">sg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">surrogate_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">s_inx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sg</span><span class="p">)</span>
<span class="n">s_inx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_inx</span><span class="p">)</span>
<span class="n">u1</span> <span class="o">=</span> <span class="n">s_inx</span> <span class="o">+</span> <span class="n">bias_01_emp_ar</span>
<span class="n">l1</span> <span class="o">=</span> <span class="n">s_inx</span> <span class="o">-</span> <span class="n">bias_01_emp_ar</span>
<span class="n">u5</span> <span class="o">=</span> <span class="n">s_inx</span> <span class="o">+</span> <span class="n">bias_05_emp_ar</span>
<span class="n">l5</span> <span class="o">=</span> <span class="n">s_inx</span> <span class="o">-</span> <span class="n">bias_05_emp_ar</span>
<span class="n">x_q</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u1</span> <span class="o">=</span> <span class="n">s_inx</span> <span class="o">+</span> <span class="n">bias_01_emp_ar</span>
<span class="n">l1</span> <span class="o">=</span> <span class="n">s_inx</span> <span class="o">-</span> <span class="n">bias_01_emp_ar</span>
<span class="n">u5</span> <span class="o">=</span> <span class="n">s_inx</span> <span class="o">+</span> <span class="n">bias_05_emp_ar</span>
<span class="n">l5</span> <span class="o">=</span> <span class="n">s_inx</span> <span class="o">-</span> <span class="n">bias_05_emp_ar</span>
<span class="n">x_q</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="c1"># cl_bias = &quot;#657f91&quot;</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">s_inx</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Actual Mean Treat Eff. Over 36 Quart.&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;#2b8777&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_q</span><span class="p">,</span> <span class="n">s_inx</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Surrogate Index Estimate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_q</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.3</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#404142&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Bounds on Bias: $R^2_Y|W = 1$%&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_q</span><span class="p">,</span> <span class="n">u5</span><span class="p">,</span> <span class="n">l5</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#a0afba&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Bounds on Bias: $R^2_Y|W = 5$%&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_lbl</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Estimated Treatment Effect on Mean</span><span class="se">\n</span><span class="s2">Employment Rate Over 9 Years (%&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[[</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9_surrogate_py_28_0.png" src="../_images/9_surrogate_py_28_0.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "d2cml-ai/mgtecon634_python",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="8_WGANs_for_simulation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">7. </span>Tutorial to simulate data using WGANs</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Phd Susan Athey<br/>
  
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>